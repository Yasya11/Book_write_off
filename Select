#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
 
struct Data
{
    char Surname[128], Name[128], Pos[128];
};
 
 
void Read(Data* D, int n, FILE *f);
void Select(char* s, Data* D, int n);
void All(char* s, Data* D, const char** Names, const char** Surnames, const char** Poss, int n);
 
 
int main ()
{
  FILE *f = fopen ("Sotr.txt", "r");
  const char* Names[] = {};
  const char* Poss[] = {};
  const char* Surnames[]  = {};
  int n=70;
  Data *D= new Data [n];
  Read(D, n, f);
  printf ("Commands:\n1) select [name=...] [surname=...] [pos=...]  \n2) show [all] [workers] [surs]\n\n");
  //printf("Write your query: ");
  char s[128];
  fgets (s, 128, stdin);
  char *p = strstr(s, "select");
  if (p != 0)
    Select(s,D,n);
  else
    {
      p=strstr(s,"show");
      if (p != 0)
        All (s,D,Names,Surnames,Poss,n);
      else
        printf ("\nNo command\n");
    }
 
  fclose (f);
  return 0;
}
 
 
void Read (Data* D, int n, FILE*f){
  for (int i=0; i<n; i++){
      fscanf (f, "%s%s%s", D[i].Name, D[i].Surname, D[i].Pos);
    }
}
 
 
void Select (char* s, Data* D, int n)
{
  bool name=0, sur=0, pos=0;
  char Name[128], Pos [128], Surname[128];
  char* p=strstr (s,"Name: ");
  if (p!=0){
      if (sscanf(p+5,"%s",Name)!=1){
          printf ("error\n");
          return;
        }
      if (Name[strlen(Name)-1]=='\n')
          Name[strlen(Name)-1]='0';
      name=1;
    }
  p=strstr (s, "Position: ");
  if(p!=0){
      if(sscanf(p+9,"%s",Pos)!=1){
          printf ("error1\n");
          return;
        }
        if (Pos[strlen(Pos)-1]=='\n')
          Pos[strlen(Pos)-1]='0';
      pos=1;
    }
  p=strstr(s,"Surname: ");
  if (p!=0)
    {
      if(sscanf(p+4 ,"%s",Surname)!=1){
          printf ("error2\n");
          return;
        }
      if (Surname[strlen(Surname)-1]=='\n')
          Surname[strlen(Surname)-1]='0';
      sur = 1;
    }
  if (!name && !pos && !sur)
    {
      printf ("\n error3\n");
      return;
    }
  int k=0;
  for (int i=0; i<n; i++){
      if (name && strcmp (Name, D[i].Name))
        continue;
      if (pos && strcmp (Pos,  D[i].Pos))
        continue;
      if (sur && strcmp (Surname, D[i].Surname))
        continue;
      printf ("%s %s %s \n", D[i].Name, D[i].Surname, D[i].Pos);
      k++;
    }
return;
}
 
void All (char* s, Data* D, const char** Names, const char** Surnames, const char** Poss, int n)
{
  int k = 0;
  char *p = strstr (s, "all");
  if (p!= 0){
      for (int i=0; i<n; i++){
          printf ("%s %s %s \n", D[i].Name, D[i].Surname, D[i].Pos);
          k++;
        }
      return;
    }
  printf ("error4\n");
  return;
}
